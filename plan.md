# 承認ワークフロービジュアルエディタ - 実装計画

## プロジェクト目標

Web上でビジュアルに承認ワークフローを設計し、BPMN 2.0形式のXMLとして出力できるシステムを構築する。

## アプローチ

段階的な開発により、MVP（最小実行可能製品）から完全機能版へと進化させる。Phase 1で基本的なビジュアルエディタを実装し、その後処理者管理、XML出力、永続化機能を順次追加する。

## 作業計画

### セットアップ・環境構築
- [ ] プロジェクト初期化（Vite + React + TypeScript）
- [ ] 依存パッケージのインストール（React Flow, React Router等）
- [ ] プロジェクト構造の作成（src/components, src/utils, src/types等）
- [ ] TypeScript型定義ファイルの作成（types.ts）
- [ ] ESLint/Prettier設定
- [ ] Git初期化とREADME作成

### Phase 1: 基本フローエディタ
- [ ] React Flowの基本セットアップ
- [ ] カスタムノードコンポーネントの作成
  - [ ] StartNode（開始ノード）
  - [ ] ApprovalNode（承認ノード）
  - [ ] EndNode（終了ノード）
- [ ] 左サイドバー：ノードパレットの実装
- [ ] 中央キャンバス：React Flowインスタンスの配置
- [ ] ドラッグ&ドロップ機能の実装
- [ ] ノード間の接続（エッジ作成）機能
- [ ] ノード選択・削除機能
- [ ] 基本的な状態管理（useState/useContext）
- [ ] ズーム・パン操作の実装
- [ ] ミニマップ・コントロールパネルの追加

### Phase 2: 処理者設定機能
- [ ] Assignee型定義とモックデータ作成
- [ ] 処理者管理コンポーネント（AssigneeManager）
  - [ ] 処理者一覧表示
  - [ ] 処理者追加フォーム
  - [ ] 処理者編集・削除機能
- [ ] 右サイドバー：プロパティパネルの実装
- [ ] ノード選択時のプロパティ表示
- [ ] 承認ノードへの処理者割り当てUI
  - [ ] ドロップダウン/チェックボックスで複数選択
- [ ] 承認ルール選択機能（全員/一人/過半数）
- [ ] ConditionNode（条件分岐ノード）の追加
- [ ] 条件分岐の設定UI

### Phase 3: XML出力機能
- [ ] BPMN 2.0スキーマの調査・理解
- [ ] フローデータ → BPMN XMLの変換ロジック
  - [ ] プロセス定義の生成
  - [ ] タスク要素の生成
  - [ ] シーケンスフローの生成
  - [ ] レーン/プールの生成（処理者情報）
- [ ] XMLBuilder/Parserユーティリティの実装
- [ ] 上部ツールバーの実装
  - [ ] XML出力ボタン
  - [ ] ファイル名入力フィールド
- [ ] XMLダウンロード機能
- [ ] XMLプレビューモーダル
  - [ ] シンタックスハイライト（react-syntax-highlighter等）
- [ ] BPMN 2.0バリデーション機能
  - [ ] XMLスキーマ検証
  - [ ] エラーメッセージ表示

### Phase 4: 保存・管理機能
- [ ] ワークフロー保存機能（LocalStorage）
  - [ ] 保存ボタンとフォーム
  - [ ] ワークフローのシリアライゼーション
- [ ] ワークフロー読み込み機能
  - [ ] 保存済みワークフロー一覧
  - [ ] 選択して読み込み
  - [ ] デシリアライゼーション
- [ ] ワークフロー削除機能
- [ ] 新規作成・クリア機能
- [ ] ワークフロー名・説明の編集
- [ ] エクスポート/インポート機能（JSON形式）

### バックエンド開発（オプション）
- [ ] Express.jsプロジェクトのセットアップ
- [ ] RESTful API設計
  - [ ] GET /api/workflows - 一覧取得
  - [ ] POST /api/workflows - 新規作成
  - [ ] GET /api/workflows/:id - 詳細取得
  - [ ] PUT /api/workflows/:id - 更新
  - [ ] DELETE /api/workflows/:id - 削除
- [ ] データベース選択と接続（MongoDB/PostgreSQL）
- [ ] スキーマ/モデル定義
- [ ] CORS設定
- [ ] APIエンドポイントの実装
- [ ] フロントエンドとの統合

### UI/UX改善
- [ ] レスポンシブデザイン対応
- [ ] ダークモード対応
- [ ] アニメーション・トランジション追加
- [ ] エラーハンドリングとユーザーフィードバック
- [ ] ローディングスピナー
- [ ] ツールチップ・ヘルプテキスト
- [ ] キーボードショートカット

### テスト・品質保証
- [ ] ユニットテスト（Vitest/Jest）
  - [ ] 変換ロジックのテスト
  - [ ] ユーティリティ関数のテスト
- [ ] コンポーネントテスト（React Testing Library）
- [ ] E2Eテスト（Playwright/Cypress）
- [ ] パフォーマンステスト（100ノード以上）
- [ ] クロスブラウザテスト

### ドキュメント作成
- [ ] README.md（セットアップ・使い方）
- [ ] CONTRIBUTING.md（開発ガイド）
- [ ] API仕様書（バックエンド実装時）
- [ ] ユーザーマニュアル
- [ ] アーキテクチャドキュメント
- [ ] コードコメント・JSDoc

### デプロイ・運用
- [ ] ビルド設定の最適化
- [ ] 環境変数の管理
- [ ] Vercel/Netlifyへのデプロイ（フロントエンド）
- [ ] Heroku/AWS等へのデプロイ（バックエンド）
- [ ] CI/CDパイプラインの構築
- [ ] モニタリング・ロギング設定

## 技術的考慮事項

### 状態管理
- Phase 1-2: React Context API
- Phase 3以降: Zustand または Redux Toolkit への移行を検討

### スタイリング
- Tailwind CSS or CSS Modules
- コンポーネントライブラリ: Material-UI or Ant Design（オプション）

### BPMN変換の課題
- React Flowの内部データ構造 → BPMN XML形式へのマッピング
- 処理者情報をBPMNのレーン/プール構造に変換
- カスタム属性の拡張

### パフォーマンス最適化
- 大規模フロー（100ノード以上）での描画最適化
- React.memo, useMemo, useCallbackの活用
- 仮想化（react-window）の検討

## マイルストーン

### MVP（最小実行可能製品）
Phase 1完了時点で、基本的なビジュアルエディタとして動作

### β版
Phase 1-3完了時点で、XML出力機能を含む基本機能が使用可能

### v1.0
全Phase完了時点で、完全機能を持つ製品版

## 注意事項

- セキュリティ: XSS対策、入力バリデーション
- アクセシビリティ: WCAG 2.1準拠
- ライセンス確認: 使用ライブラリのライセンス互換性
- ブラウザ互換性: Chrome, Firefox, Safari, Edge

## 次のステップ

1. プロジェクト環境構築を開始
2. React Flow公式ドキュメントの精読
3. BPMN 2.0仕様の詳細確認
4. Phase 1の実装開始
