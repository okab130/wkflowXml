# 承認ワークフロービジュアルエディタ - タスク一覧

## タスク構造

各タスクには以下の情報が含まれます：
- **ID**: タスクの一意識別子
- **タイトル**: タスクの簡潔な説明
- **説明**: 詳細な実装内容
- **依存関係**: 前提となるタスク
- **成果物**: タスク完了時の具体的な成果物
- **見積もり**: 複雑度（Small/Medium/Large）

---

## セットアップ・環境構築

### SETUP-01: プロジェクト初期化
**説明**: Vite + React + TypeScriptでプロジェクトを初期化  
**依存関係**: なし  
**成果物**: `package.json`, `vite.config.ts`, `tsconfig.json`  
**見積もり**: Small  
**実装内容**:
- `npm create vite@latest workflow-editor -- --template react-ts`
- プロジェクト名と設定の確認
- 初期ファイルの確認とクリーンアップ

### SETUP-02: 依存パッケージインストール
**説明**: React Flow、React Router等の必要なパッケージをインストール  
**依存関係**: SETUP-01  
**成果物**: 更新された`package.json`, `node_modules/`  
**見積もり**: Small  
**パッケージリスト**:
- `reactflow` - ビジュアルフローエディタ
- `react-router-dom` - ルーティング（オプション）
- `zustand` - 状態管理
- `react-icons` - アイコン
- `uuid` - ユニークID生成
- `fast-xml-parser` - XML処理

### SETUP-03: プロジェクト構造作成
**説明**: srcディレクトリ以下の構造を作成  
**依存関係**: SETUP-01  
**成果物**: ディレクトリ構造  
**見積もり**: Small  
**ディレクトリ構造**:
```
src/
├── components/
│   ├── nodes/
│   ├── edges/
│   ├── sidebar/
│   └── toolbar/
├── utils/
├── types/
├── store/
└── styles/
```

### SETUP-04: TypeScript型定義
**説明**: アプリケーション全体で使用する型定義を作成  
**依存関係**: SETUP-03  
**成果物**: `src/types/index.ts`  
**見積もり**: Medium  
**型定義内容**:
- `Workflow`, `Node`, `Edge`, `Assignee`インターフェース
- ノードタイプの列挙型
- 承認ルールの列挙型

### SETUP-05: ESLint/Prettier設定
**説明**: コード品質・フォーマット設定  
**依存関係**: SETUP-01  
**成果物**: `.eslintrc.json`, `.prettierrc`  
**見積もり**: Small  

### SETUP-06: Git初期化とREADME
**説明**: バージョン管理の初期化とプロジェクト概要文書  
**依存関係**: SETUP-01  
**成果物**: `.git/`, `.gitignore`, `README.md`  
**見積もり**: Small  

---

## Phase 1: 基本フローエディタ

### P1-01: React Flow基本セットアップ
**説明**: React Flowの初期統合とキャンバス表示  
**依存関係**: SETUP-02, SETUP-03  
**成果物**: `src/components/FlowCanvas.tsx`  
**見積もり**: Medium  
**実装内容**:
- ReactFlowコンポーネントの配置
- 基本的なノードとエッジのstate管理
- スタイルのインポート

### P1-02: カスタムノード - StartNode
**説明**: 開始ノードのカスタムコンポーネント作成  
**依存関係**: P1-01, SETUP-04  
**成果物**: `src/components/nodes/StartNode.tsx`  
**見積もり**: Medium  
**実装内容**:
- 緑色の円形アイコン
- ラベル表示
- ハンドル（接続点）の配置

### P1-03: カスタムノード - ApprovalNode
**説明**: 承認ノードのカスタムコンポーネント作成  
**依存関係**: P1-01, SETUP-04  
**成果物**: `src/components/nodes/ApprovalNode.tsx`  
**見積もり**: Medium  
**実装内容**:
- 青色の矩形アイコン
- ラベルと処理者情報表示
- 入力/出力ハンドルの配置

### P1-04: カスタムノード - EndNode
**説明**: 終了ノードのカスタムコンポーネント作成  
**依存関係**: P1-01, SETUP-04  
**成果物**: `src/components/nodes/EndNode.tsx`  
**見積もり**: Medium  
**実装内容**:
- 赤色の円形アイコン
- ラベル表示
- 入力ハンドルのみ配置

### P1-05: ノードタイプ登録
**説明**: カスタムノードをReact Flowに登録  
**依存関係**: P1-02, P1-03, P1-04  
**成果物**: 更新された`FlowCanvas.tsx`  
**見積もり**: Small  

### P1-06: ノードパレット - サイドバー
**説明**: 左サイドバーのノードパレットUI  
**依存関係**: P1-05  
**成果物**: `src/components/sidebar/NodePalette.tsx`  
**見積もり**: Medium  
**実装内容**:
- ドラッグ可能なノードアイコンリスト
- 各ノードタイプのアイコンと説明
- ドラッグイベントハンドラ

### P1-07: ドラッグ&ドロップ機能
**説明**: パレットからキャンバスへのノード配置  
**依存関係**: P1-06  
**成果物**: 更新された`FlowCanvas.tsx`  
**見積もり**: Medium  
**実装内容**:
- onDragOverハンドラ
- onDropハンドラ
- 新規ノードの生成とposition計算

### P1-08: ノード接続機能
**説明**: ノード間のエッジ作成  
**依存関係**: P1-05  
**成果物**: 更新された`FlowCanvas.tsx`  
**見積もり**: Small  
**実装内容**:
- onConnectハンドラ
- エッジの検証（循環参照チェック）

### P1-09: ノード選択・削除
**説明**: ノードの選択とDeleteキーでの削除  
**依存関係**: P1-05  
**成果物**: 更新された`FlowCanvas.tsx`  
**見積もり**: Small  
**実装内容**:
- onNodeClickハンドラ
- onKeyDownハンドラ
- 選択ノードのハイライト表示

### P1-10: 状態管理セットアップ
**説明**: Zustandストアの作成と統合  
**依存関係**: SETUP-02, SETUP-04  
**成果物**: `src/store/workflowStore.ts`  
**見積もり**: Medium  
**実装内容**:
- nodes, edges, selectedNodeのstate
- addNode, removeNode, updateNodeなどのアクション
- ストアのReact Flowへの接続

### P1-11: ズーム・パン操作
**説明**: キャンバスのズームとパン機能  
**依存関係**: P1-01  
**成果物**: 更新された`FlowCanvas.tsx`  
**見積もり**: Small  
**実装内容**:
- React Flowの`MiniMap`コンポーネント追加
- `Controls`コンポーネント追加
- `Background`コンポーネント追加

### P1-12: メインレイアウト統合
**説明**: サイドバーとキャンバスの統合レイアウト  
**依存関係**: P1-06, P1-11  
**成果物**: `src/App.tsx`  
**見積もり**: Small  
**実装内容**:
- CSSグリッドまたはFlexboxレイアウト
- レスポンシブ対応

---

## Phase 2: 処理者設定機能

### P2-01: Assignee型定義とモックデータ
**説明**: 処理者の型定義とテスト用データ作成  
**依存関係**: SETUP-04  
**成果物**: 更新された`types/index.ts`, `utils/mockData.ts`  
**見積もり**: Small  

### P2-02: 処理者ストア
**説明**: 処理者管理用のZustandストア  
**依存関係**: P2-01, P1-10  
**成果物**: `src/store/assigneeStore.ts`  
**見積もり**: Small  
**実装内容**:
- assigneesのstate
- addAssignee, removeAssignee, updateAssigneeアクション

### P2-03: 処理者一覧表示
**説明**: 処理者リストコンポーネント  
**依存関係**: P2-02  
**成果物**: `src/components/sidebar/AssigneeList.tsx`  
**見積もり**: Medium  
**実装内容**:
- 処理者の一覧表示（名前、メール、役職）
- 編集・削除ボタン

### P2-04: 処理者追加フォーム
**説明**: 新規処理者追加UI  
**依存関係**: P2-02  
**成果物**: `src/components/sidebar/AssigneeForm.tsx`  
**見積もり**: Medium  
**実装内容**:
- 入力フォーム（名前、メール、役職、部署）
- バリデーション
- 追加ボタン

### P2-05: 処理者編集・削除機能
**説明**: 既存処理者の編集と削除  
**依存関係**: P2-03, P2-04  
**成果物**: 更新された`AssigneeList.tsx`, `AssigneeForm.tsx`  
**見積もり**: Medium  
**実装内容**:
- 編集モーダルまたはインライン編集
- 削除確認ダイアログ

### P2-06: プロパティパネル - 右サイドバー
**説明**: 選択ノードのプロパティ表示エリア  
**依存関係**: P1-09  
**成果物**: `src/components/sidebar/PropertyPanel.tsx`  
**見積もり**: Medium  
**実装内容**:
- 選択ノードの情報表示
- ノード名編集フィールド
- ノードタイプに応じた動的コンテンツ

### P2-07: 処理者割り当てUI
**説明**: 承認ノードへの処理者割り当て  
**依存関係**: P2-06, P2-02  
**成果物**: `src/components/sidebar/AssigneeSelector.tsx`  
**見積もり**: Medium  
**実装内容**:
- マルチセレクトドロップダウン
- 選択済み処理者の表示
- 処理者の追加・削除

### P2-08: 承認ルール選択UI
**説明**: 複数処理者の承認ルール設定  
**依存関係**: P2-07  
**成果物**: 更新された`PropertyPanel.tsx`  
**見積もり**: Small  
**実装内容**:
- ラジオボタン（全員/一人/過半数）
- ルール説明のツールチップ

### P2-09: ConditionNode実装
**説明**: 条件分岐ノードの作成  
**依存関係**: P1-05  
**成果物**: `src/components/nodes/ConditionNode.tsx`  
**見積もり**: Medium  
**実装内容**:
- 黄色の菱形アイコン
- 複数の出力ハンドル
- 条件ラベル表示

### P2-10: 条件分岐設定UI
**説明**: 条件ノードの分岐条件設定  
**依存関係**: P2-09, P2-06  
**成果物**: 更新された`PropertyPanel.tsx`  
**見積もり**: Medium  
**実装内容**:
- 条件入力フィールド
- 各エッジへの条件割り当て

### P2-11: エッジラベル表示
**説明**: エッジに条件やラベルを表示  
**依存関係**: P2-10  
**成果物**: 更新された`FlowCanvas.tsx`  
**見積もり**: Small  

---

## Phase 3: XML出力機能

### P3-01: BPMN 2.0スキーマ調査
**説明**: BPMN 2.0仕様の理解とスキーマ確認  
**依存関係**: なし  
**成果物**: ドキュメントメモ  
**見積もり**: Small  

### P3-02: XMLBuilderユーティリティ
**説明**: XMLを構築するヘルパー関数  
**依存関係**: SETUP-02, P3-01  
**成果物**: `src/utils/xmlBuilder.ts`  
**見積もり**: Medium  
**実装内容**:
- XMLヘッダー生成
- 要素・属性の追加関数
- インデント整形

### P3-03: プロセス定義生成
**説明**: BPMNプロセス要素の生成  
**依存関係**: P3-02  
**成果物**: 更新された`xmlBuilder.ts`  
**見積もり**: Medium  
**実装内容**:
- `<bpmn:process>` 要素の生成
- プロセスID、名前の設定

### P3-04: タスク要素生成
**説明**: ノード → BPMNタスクへの変換  
**依存関係**: P3-03  
**成果物**: 更新された`xmlBuilder.ts`  
**見積もり**: Large  
**実装内容**:
- StartEvent, UserTask, EndEventの生成
- ノードIDのマッピング
- タスク名、属性の設定

### P3-05: シーケンスフロー生成
**説明**: エッジ → BPMNシーケンスフローへの変換  
**依存関係**: P3-04  
**成果物**: 更新された`xmlBuilder.ts`  
**見積もり**: Medium  
**実装内容**:
- `<bpmn:sequenceFlow>` 要素の生成
- source/target参照の設定
- 条件式の追加

### P3-06: レーン/プール生成
**説明**: 処理者情報のBPMN表現  
**依存関係**: P3-04  
**成果物**: 更新された`xmlBuilder.ts`  
**見積もり**: Large  
**実装内容**:
- `<bpmn:lane>` および `<bpmn:laneSet>` 生成
- 処理者 → レーンのマッピング
- タスクのレーン割り当て

### P3-07: BPMN変換統合関数
**説明**: フローデータ全体をBPMN XMLに変換  
**依存関係**: P3-06  
**成果物**: `src/utils/bpmnConverter.ts`  
**見積もり**: Medium  
**実装内容**:
- ワークフロー → BPMN変換のメイン関数
- エラーハンドリング

### P3-08: 上部ツールバーUI
**説明**: アクションボタンを含むツールバー  
**依存関係**: なし  
**成果物**: `src/components/toolbar/Toolbar.tsx`  
**見積もり**: Medium  
**実装内容**:
- 保存、読み込み、XML出力ボタン
- ファイル名入力フィールド
- ズームコントロール

### P3-09: XMLダウンロード機能
**説明**: 生成したXMLをファイルとしてダウンロード  
**依存関係**: P3-07, P3-08  
**成果物**: 更新された`Toolbar.tsx`, `utils/fileHelper.ts`  
**見積もり**: Small  
**実装内容**:
- Blob生成とダウンロードトリガー
- ファイル名のカスタマイズ

### P3-10: XMLプレビューモーダル
**説明**: 出力前のXMLプレビュー表示  
**依存関係**: P3-07  
**成果物**: `src/components/toolbar/XmlPreviewModal.tsx`  
**見積もり**: Medium  
**実装内容**:
- モーダルダイアログ
- コード表示エリア
- コピーボタン

### P3-11: シンタックスハイライト
**説明**: XMLコードの見やすい表示  
**依存関係**: P3-10, SETUP-02  
**成果物**: 更新された`XmlPreviewModal.tsx`  
**見積もり**: Small  
**実装内容**:
- `react-syntax-highlighter`の統合
- XMLテーマの適用

### P3-12: BPMN検証機能
**説明**: 生成XMLの妥当性チェック  
**依存関係**: P3-07  
**成果物**: `src/utils/bpmnValidator.ts`  
**見積もり**: Large  
**実装内容**:
- 必須要素の存在確認
- 参照整合性チェック
- エラーメッセージ生成

### P3-13: 検証エラー表示
**説明**: バリデーションエラーのUI表示  
**依存関係**: P3-12, P3-10  
**成果物**: 更新された`XmlPreviewModal.tsx`  
**見積もり**: Small  

---

## Phase 4: 保存・管理機能

### P4-01: LocalStorage保存関数
**説明**: ワークフローをLocalStorageに保存  
**依存関係**: P1-10  
**成果物**: `src/utils/storageHelper.ts`  
**見積もり**: Small  
**実装内容**:
- シリアライゼーション（JSON.stringify）
- LocalStorage API使用

### P4-02: LocalStorage読み込み関数
**説明**: 保存済みワークフローの読み込み  
**依存関係**: P4-01  
**成果物**: 更新された`storageHelper.ts`  
**見積もり**: Small  
**実装内容**:
- デシリアライゼーション（JSON.parse）
- エラーハンドリング

### P4-03: 保存ボタンとフォーム
**説明**: ワークフロー保存UI  
**依存関係**: P4-01, P3-08  
**成果物**: `src/components/toolbar/SaveDialog.tsx`  
**見積もり**: Medium  
**実装内容**:
- モーダルダイアログ
- ワークフロー名・説明入力
- 保存実行ボタン

### P4-04: ワークフロー一覧表示
**説明**: 保存済みワークフローのリスト  
**依存関係**: P4-02  
**成果物**: `src/components/toolbar/WorkflowList.tsx`  
**見積もり**: Medium  
**実装内容**:
- LocalStorageから一覧取得
- サムネイル、名前、日時表示
- 読み込み・削除ボタン

### P4-05: ワークフロー読み込み
**説明**: 選択したワークフローをキャンバスに復元  
**依存関係**: P4-04, P1-10  
**成果物**: 更新された`WorkflowList.tsx`  
**見積もり**: Medium  
**実装内容**:
- ストアへのデータ反映
- キャンバスの再描画

### P4-06: ワークフロー削除
**説明**: 保存済みワークフローの削除  
**依存関係**: P4-04  
**成果物**: 更新された`WorkflowList.tsx`  
**見積もり**: Small  
**実装内容**:
- 削除確認ダイアログ
- LocalStorageからの削除

### P4-07: 新規作成・クリア機能
**説明**: キャンバスをリセットして新規作成  
**依存関係**: P1-10, P3-08  
**成果物**: 更新された`Toolbar.tsx`  
**見積もり**: Small  
**実装内容**:
- 確認ダイアログ
- ストアのクリア

### P4-08: ワークフロー名・説明編集
**説明**: 既存ワークフローのメタデータ編集  
**依存関係**: P4-04  
**成果物**: 更新された`WorkflowList.tsx`  
**見積もり**: Medium  

### P4-09: JSON形式エクスポート
**説明**: ワークフローをJSONファイルでエクスポート  
**依存関係**: P1-10, P3-08  
**成果物**: 更新された`Toolbar.tsx`, `fileHelper.ts`  
**見積もり**: Small  

### P4-10: JSON形式インポート
**説明**: JSONファイルからワークフローをインポート  
**依存関係**: P4-09  
**成果物**: 更新された`Toolbar.tsx`, `fileHelper.ts`  
**見積もり**: Medium  
**実装内容**:
- ファイル選択ダイアログ
- JSON解析とバリデーション
- ストアへの反映

---

## UI/UX改善

### UX-01: レスポンシブデザイン
**説明**: モバイル・タブレット対応  
**依存関係**: P1-12  
**成果物**: 更新されたCSS/スタイル  
**見積もり**: Medium  

### UX-02: ダークモード
**説明**: ダークテーマの実装  
**依存関係**: P1-12  
**成果物**: テーマ切り替え機能、CSS変数  
**見積もり**: Medium  

### UX-03: アニメーション
**説明**: UIトランジションとアニメーション  
**依存関係**: P1-12  
**成果物**: CSS/JSアニメーション  
**見積もり**: Small  

### UX-04: エラーハンドリング
**説明**: 統一されたエラー表示  
**依存関係**: なし  
**成果物**: `src/components/common/ErrorToast.tsx`  
**見積もり**: Medium  

### UX-05: ローディングスピナー
**説明**: 非同期処理中のローディング表示  
**依存関係**: なし  
**成果物**: `src/components/common/Spinner.tsx`  
**見積もり**: Small  

### UX-06: ツールチップ
**説明**: UI要素の説明ツールチップ  
**依存関係**: なし  
**成果物**: `src/components/common/Tooltip.tsx`  
**見積もり**: Small  

### UX-07: キーボードショートカット
**説明**: 主要操作のショートカット  
**依存関係**: P1-09  
**成果物**: ショートカットハンドラ  
**見積もり**: Medium  
**ショートカット例**:
- Ctrl+S: 保存
- Ctrl+Z: Undo
- Delete: ノード削除
- Ctrl+E: XML出力

---

## テスト・品質保証

### TEST-01: テストセットアップ
**説明**: Vitest/React Testing Libraryの設定  
**依存関係**: SETUP-01  
**成果物**: `vitest.config.ts`, `src/setupTests.ts`  
**見積もり**: Small  

### TEST-02: 変換ロジックのユニットテスト
**説明**: BPMN変換関数のテスト  
**依存関係**: P3-07, TEST-01  
**成果物**: `src/utils/__tests__/bpmnConverter.test.ts`  
**見積もり**: Large  

### TEST-03: ユーティリティ関数テスト
**説明**: ヘルパー関数のテスト  
**依存関係**: TEST-01  
**成果物**: 各ユーティリティの`__tests__/`ディレクトリ  
**見積もり**: Medium  

### TEST-04: コンポーネントテスト
**説明**: Reactコンポーネントのテスト  
**依存関係**: TEST-01  
**成果物**: コンポーネントごとの`.test.tsx`ファイル  
**見積もり**: Large  

### TEST-05: E2Eテストセットアップ
**説明**: Playwright/Cypressの設定  
**依存関係**: SETUP-01  
**成果物**: `e2e/`ディレクトリ、設定ファイル  
**見積もり**: Medium  

### TEST-06: E2Eテストシナリオ
**説明**: 主要フローのE2Eテスト  
**依存関係**: TEST-05, P4-10  
**成果物**: `e2e/workflow.spec.ts`  
**見積もり**: Large  

### TEST-07: パフォーマンステスト
**説明**: 100ノード以上での動作確認  
**依存関係**: P1-11  
**成果物**: パフォーマンステストスクリプト  
**見積もり**: Medium  

---

## ドキュメント

### DOC-01: README作成
**説明**: プロジェクト概要とセットアップ手順  
**依存関係**: SETUP-06, P1-12  
**成果物**: 更新された`README.md`  
**見積もり**: Medium  
**内容**:
- プロジェクト概要
- 機能リスト
- インストール手順
- 使い方
- スクリーンショット

### DOC-02: CONTRIBUTING作成
**説明**: 開発者向けガイド  
**依存関係**: TEST-01  
**成果物**: `CONTRIBUTING.md`  
**見積もり**: Small  

### DOC-03: ユーザーマニュアル
**説明**: エンドユーザー向け操作マニュアル  
**依存関係**: P4-10  
**成果物**: `docs/USER_MANUAL.md`  
**見積もり**: Medium  

### DOC-04: アーキテクチャドキュメント
**説明**: システム設計書  
**依存関係**: P3-07  
**成果物**: `docs/ARCHITECTURE.md`  
**見積もり**: Medium  

### DOC-05: API仕様書
**説明**: バックエンドAPI仕様（実装時）  
**依存関係**: バックエンド実装  
**成果物**: `docs/API.md`  
**見積もり**: Medium  

---

## バックエンド開発（オプション）

### BE-01: Expressセットアップ
**説明**: Express.jsプロジェクトの初期化  
**依存関係**: なし  
**成果物**: `server/`ディレクトリ、`server.js`  
**見積もり**: Small  

### BE-02: データベース選択と接続
**説明**: MongoDB/PostgreSQLの選択と接続設定  
**依存関係**: BE-01  
**成果物**: データベース接続モジュール  
**見積もり**: Medium  

### BE-03: スキーマ/モデル定義
**説明**: データベーススキーマの定義  
**依存関係**: BE-02  
**成果物**: モデルファイル  
**見積もり**: Medium  

### BE-04: APIエンドポイント実装
**説明**: CRUD操作のAPI実装  
**依存関係**: BE-03  
**成果物**: ルーターとコントローラー  
**見積もり**: Large  

### BE-05: CORS設定
**説明**: クロスオリジン設定  
**依存関係**: BE-01  
**成果物**: 更新された`server.js`  
**見積もり**: Small  

### BE-06: フロントエンド統合
**説明**: APIクライアントの実装  
**依存関係**: BE-04, P4-01  
**成果物**: `src/api/workflowApi.ts`  
**見積もり**: Medium  

---

## デプロイ・運用

### DEPLOY-01: ビルド最適化
**説明**: プロダクションビルド設定  
**依存関係**: SETUP-01  
**成果物**: 更新された`vite.config.ts`  
**見積もり**: Small  

### DEPLOY-02: 環境変数管理
**説明**: 環境ごとの設定管理  
**依存関係**: DEPLOY-01  
**成果物**: `.env.example`, 環境変数読み込みロジック  
**見積もり**: Small  

### DEPLOY-03: フロントエンドデプロイ
**説明**: Vercel/Netlifyへのデプロイ  
**依存関係**: DEPLOY-01  
**成果物**: デプロイ設定ファイル  
**見積もり**: Small  

### DEPLOY-04: バックエンドデプロイ
**説明**: サーバーのデプロイ（実装時）  
**依存関係**: BE-06, DEPLOY-02  
**成果物**: デプロイ設定  
**見積もり**: Medium  

### DEPLOY-05: CI/CDパイプライン
**説明**: GitHub Actionsでの自動化  
**依存関係**: TEST-01  
**成果物**: `.github/workflows/ci.yml`  
**見積もり**: Medium  

---

## サマリー

**総タスク数**: 88タスク

**フェーズ別内訳**:
- セットアップ: 6タスク
- Phase 1: 12タスク
- Phase 2: 11タスク
- Phase 3: 13タスク
- Phase 4: 10タスク
- UI/UX改善: 7タスク
- テスト: 7タスク
- ドキュメント: 5タスク
- バックエンド: 6タスク（オプション）
- デプロイ: 5タスク

**優先実装パス（MVP）**:
1. SETUP-01 → SETUP-06
2. P1-01 → P1-12
3. P2-01 → P2-11
4. P3-01 → P3-13
5. P4-01 → P4-10
6. TEST-01 → TEST-04
7. DOC-01, DOC-03

**依存関係グラフ**:
```
SETUP → Phase 1 → Phase 2 → Phase 3 → Phase 4
                      ↓          ↓         ↓
                   UI/UX  →   テスト  →  デプロイ
```
